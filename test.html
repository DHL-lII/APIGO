<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIGO 测试页面</title>
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .container {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 15px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 3px;
            background-color: #f9f9f9;
            min-height: 100px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f1f1f1;
            margin-right: 5px;
            border-radius: 3px 3px 0 0;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .status {
            margin-top: 10px;
            font-weight: bold;
        }
        .status.success {
            color: #4CAF50;
        }
        .status.error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>APIGO 测试页面</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="login">ERP登录</div>
        <div class="tab" data-tab="wx-login">微信登录</div>
        <div class="tab" data-tab="version">版本测试</div>
        <div class="tab" data-tab="public-api">匿名API</div>
        <div class="tab" data-tab="auth-api">鉴权API</div>
    </div>
    
    <div class="container tab-content active" id="login">
        <h2>ERP登录测试</h2>
        <div class="form-group">
            <label for="loginName">登录名:</label>
            <input type="text" id="loginName" value="admin">
        </div>
        <div class="form-group">
            <label for="password">密码:</label>
            <input type="password" id="password" value="admin">
        </div>
        <button id="loginBtn">登录</button>
        <div class="status" id="loginStatus"></div>
        <div class="result" id="loginResult"></div>
    </div>
    
    <div class="container tab-content" id="wx-login">
        <h2>微信登录测试</h2>
        <p>注意: 微信登录需要在微信环境中使用，这里仅作模拟测试</p>
        <div class="form-group">
            <label for="wxCode">微信Code:</label>
            <input type="text" id="wxCode" value="123456">
        </div>
        <button id="wxLoginBtn">微信登录</button>
        <div class="status" id="wxLoginStatus"></div>
        <div class="result" id="wxLoginResult"></div>
    </div>
    
    <div class="container tab-content" id="version">
        <h2>获取版本测试</h2>
        <p>这是一个特殊测试，版本查询鉴权字段为NULL，可测试系统处理NULL值的情况</p>
        <button id="versionBtn">获取版本</button>
        <div class="status" id="versionStatus"></div>
        <div class="result" id="versionResult"></div>
        <p class="status error">注意：此接口设计为返回错误，用于测试系统对NULL鉴权值的处理</p>
    </div>
    
    <div class="container tab-content" id="public-api">
        <h2>匿名API测试</h2>
        <div class="form-group">
            <label for="publicApiPath">API路径:</label>
            <input type="text" id="publicApiPath" value="ver">
        </div>
        <div class="form-group">
            <label for="publicApiMethod">请求方法:</label>
            <select id="publicApiMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>
        <div class="form-group">
            <label for="publicApiParams">参数 (JSON格式):</label>
            <input type="text" id="publicApiParams" value='{}'>
        </div>
        <button id="publicApiBtn">发送请求</button>
        <div class="status" id="publicApiStatus"></div>
        <div class="result" id="publicApiResult"></div>
    </div>
    
    <div class="container tab-content" id="auth-api">
        <h2>鉴权API测试</h2>
        <div class="form-group">
            <label for="authApiToken">Token:</label>
            <input type="text" id="authApiToken" placeholder="请先登录获取token">
        </div>
        <div class="form-group">
            <label for="authApiPath">API路径:</label>
            <input type="text" id="authApiPath" value="users">
        </div>
        <div class="form-group">
            <label for="authApiMethod">请求方法:</label>
            <select id="authApiMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>
        <div class="form-group">
            <label for="authApiParams">参数 (JSON格式):</label>
            <input type="text" id="authApiParams" value='{}'>
        </div>
        <button id="authApiBtn">发送请求</button>
        <div class="status" id="authApiStatus"></div>
        <div class="result" id="authApiResult"></div>
    </div>

    <script>
        // 基础配置
        const API_BASE_URL = 'http://localhost:9092';
        
        // 辅助函数
        function formatJson(json) {
            return JSON.stringify(json, null, 2);
        }
        
        function setStatus(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status ' + (isSuccess ? 'success' : 'error');
        }
        
        function setResult(elementId, data) {
            document.getElementById(elementId).textContent = typeof data === 'object' ? formatJson(data) : data;
        }
        
        // 切换标签
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-tab')).classList.add('active');
            });
        });
        
        // ERP登录测试
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const loginName = document.getElementById('loginName').value;
            const password = document.getElementById('password').value;
            
            if (!loginName || !password) {
                setStatus('loginStatus', '请输入登录名和密码', false);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ loginName, password })
                });
                
                const data = await response.json();
                setResult('loginResult', data);
                
                if (data.status === 0 && data.data && data.data.token) {
                    setStatus('loginStatus', '登录成功', true);
                    document.getElementById('authApiToken').value = data.data.token;
                } else {
                    setStatus('loginStatus', '登录失败: ' + (data.msg || '未知错误'), false);
                }
            } catch (error) {
                setStatus('loginStatus', '请求错误: ' + error.message, false);
                setResult('loginResult', error.toString());
            }
        });
        
        // 微信登录测试
        document.getElementById('wxLoginBtn').addEventListener('click', async function() {
            const code = document.getElementById('wxCode').value;
            
            if (!code) {
                setStatus('wxLoginStatus', '请输入微信Code', false);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/wx/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code })
                });
                
                const data = await response.json();
                setResult('wxLoginResult', data);
                
                if (data.status === 0 && data.data && data.data.token) {
                    setStatus('wxLoginStatus', '微信登录成功', true);
                    document.getElementById('authApiToken').value = data.data.token;
                } else {
                    setStatus('wxLoginStatus', '微信登录失败: ' + (data.msg || '未知错误'), false);
                }
            } catch (error) {
                setStatus('wxLoginStatus', '请求错误: ' + error.message, false);
                setResult('wxLoginResult', error.toString());
            }
        });
        
        // 版本测试
        document.getElementById('versionBtn').addEventListener('click', async function() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/ver`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                setResult('versionResult', data);
                
                if (response.ok) {
                    setStatus('versionStatus', '请求已处理', true);
                } else {
                    setStatus('versionStatus', '请求失败: ' + (data.msg || '未知错误'), false);
                }
            } catch (error) {
                setStatus('versionStatus', '请求错误: ' + error.message, false);
                setResult('versionResult', error.toString());
            }
        });
        
        // 匿名API测试
        document.getElementById('publicApiBtn').addEventListener('click', async function() {
            const path = document.getElementById('publicApiPath').value;
            const method = document.getElementById('publicApiMethod').value;
            let paramsStr = document.getElementById('publicApiParams').value;
            
            if (!path) {
                setStatus('publicApiStatus', '请输入API路径', false);
                return;
            }
            
            let params = {};
            if (paramsStr) {
                try {
                    params = JSON.parse(paramsStr);
                } catch (e) {
                    setStatus('publicApiStatus', '参数格式错误', false);
                    return;
                }
            }
            
            try {
                let url = `${API_BASE_URL}/api/${path}`;
                let options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (method === 'GET') {
                    // 将参数添加到URL
                    const queryParams = new URLSearchParams();
                    for (const key in params) {
                        queryParams.append(key, params[key]);
                    }
                    if (queryParams.toString()) {
                        url += '?' + queryParams.toString();
                    }
                } else {
                    // 将参数添加到请求体
                    options.body = JSON.stringify(params);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                setResult('publicApiResult', data);
                
                if (data.status === 0) {
                    setStatus('publicApiStatus', '请求成功', true);
                } else {
                    setStatus('publicApiStatus', '请求失败: ' + (data.msg || '未知错误'), false);
                }
            } catch (error) {
                setStatus('publicApiStatus', '请求错误: ' + error.message, false);
                setResult('publicApiResult', error.toString());
            }
        });
        
        // 鉴权API测试
        document.getElementById('authApiBtn').addEventListener('click', async function() {
            const token = document.getElementById('authApiToken').value;
            const path = document.getElementById('authApiPath').value;
            const method = document.getElementById('authApiMethod').value;
            let paramsStr = document.getElementById('authApiParams').value;
            
            if (!token) {
                setStatus('authApiStatus', '请先登录获取Token', false);
                return;
            }
            
            if (!path) {
                setStatus('authApiStatus', '请输入API路径', false);
                return;
            }
            
            let params = {};
            if (paramsStr) {
                try {
                    params = JSON.parse(paramsStr);
                } catch (e) {
                    setStatus('authApiStatus', '参数格式错误', false);
                    return;
                }
            }
            
            try {
                let url = `${API_BASE_URL}/api/${path}`;
                let options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                };
                
                if (method === 'GET') {
                    // 将参数添加到URL
                    const queryParams = new URLSearchParams();
                    for (const key in params) {
                        queryParams.append(key, params[key]);
                    }
                    if (queryParams.toString()) {
                        url += '?' + queryParams.toString();
                    }
                } else {
                    // 将参数添加到请求体
                    options.body = JSON.stringify(params);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                setResult('authApiResult', data);
                
                if (data.status === 0) {
                    setStatus('authApiStatus', '请求成功', true);
                } else {
                    setStatus('authApiStatus', '请求失败: ' + (data.msg || '未知错误'), false);
                }
            } catch (error) {
                setStatus('authApiStatus', '请求错误: ' + error.message, false);
                setResult('authApiResult', error.toString());
            }
        });
    </script>
</body>
</html> 